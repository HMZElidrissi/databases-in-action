"use strict";(self.webpackChunkdatabases_in_action=self.webpackChunkdatabases_in_action||[]).push([[288],{2308:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var n=s(4848),t=s(8453);const a={sidebar_position:9},i="Cursors and Triggers",o={id:"Relational-Database-Management-Systems/Triggers-and-Cursors",title:"Cursors and Triggers",description:"Cursor",source:"@site/docs/Relational-Database-Management-Systems/Triggers-and-Cursors.md",sourceDirName:"Relational-Database-Management-Systems",slug:"/Relational-Database-Management-Systems/Triggers-and-Cursors",permalink:"/databases-in-action/docs/Relational-Database-Management-Systems/Triggers-and-Cursors",draft:!1,unlisted:!1,editUrl:"https://github.com/HMZElidrissi/databases-in-action/blob/main/docs/Relational-Database-Management-Systems/Triggers-and-Cursors.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"View",permalink:"/databases-in-action/docs/Relational-Database-Management-Systems/Views"},next:{title:"Procedures",permalink:"/databases-in-action/docs/Relational-Database-Management-Systems/Procedures"}},l={},c=[{value:"Cursor",id:"cursor",level:2},{value:"Use Cases for Cursors",id:"use-cases-for-cursors",level:3},{value:"How Cursors Work",id:"how-cursors-work",level:3},{value:"Example in SQL",id:"example-in-sql",level:3},{value:"Triggers",id:"triggers",level:2},{value:"Creating a Trigger",id:"creating-a-trigger",level:3},{value:"Dropping a Trigger",id:"dropping-a-trigger",level:3},{value:"OLD and NEW Pseudo-Rows",id:"old-and-new-pseudo-rows",level:3},{value:"Example in SQL",id:"example-in-sql-1",level:3}];function d(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"cursors-and-triggers",children:"Cursors and Triggers"}),"\n",(0,n.jsx)(r.h2,{id:"cursor",children:"Cursor"}),"\n",(0,n.jsx)(r.p,{children:"Cursors are a feature used in database management systems to process individual rows returned by database system queries. Cursors enable manipulation of the row data in a manner that allows for more complex logic than a set-based operation like a standard SELECT query."}),"\n",(0,n.jsx)(r.h3,{id:"use-cases-for-cursors",children:"Use Cases for Cursors"}),"\n",(0,n.jsx)(r.p,{children:"Cursors are typically used when you need to read, update, or compute on data row by row. Common use cases include:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Complex calculations that require row-by-row logic."}),"\n",(0,n.jsxs)(r.li,{children:["Sequential processing where the action taken on row ",(0,n.jsx)(r.code,{children:"n"})," might depend on the data from row ",(0,n.jsx)(r.code,{children:"n-1"}),"."]}),"\n",(0,n.jsx)(r.li,{children:"Iterative processes within stored procedures where procedural logic is required for each row of a result set."}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"how-cursors-work",children:"How Cursors Work"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Declaration"}),": Before you can use a cursor, you need to declare it. The declaration binds the cursor to a specific ",(0,n.jsx)(r.code,{children:"SELECT"})," statement which defines the result set."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Opening"}),": After declaring a cursor, you open it to establish the result set from the ",(0,n.jsx)(r.code,{children:"SELECT"})," statement. This is when the cursor starts to work with the data."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Fetching"}),": Once the cursor is open, you can fetch rows from the result set one at a time. Fetching a row retrieves the current row's data and moves the cursor to the next row in the result set."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Processing"}),": After fetching a row, you can process the data just as you would in a normal variable context within your SQL code. This often involves applying business logic, updating values, or making decisions based on the data."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Closing"}),": When you've finished processing the rows, you should close the cursor to release the associated resources. This is an important step to prevent resource leaks."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Deallocating"}),": In some systems, you might also need to deallocate the cursor to remove it completely and free up system resources."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"example-in-sql",children:"Example in SQL"}),"\n",(0,n.jsx)(r.p,{children:"Here's a simplified example of how you might use a cursor in a SQL stored procedure:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"BEGIN\n    -- Declare the cursor\n    DECLARE cursor_name CURSOR FOR \n    SELECT column1 FROM table_name;\n\n    -- Declare variables\n    DECLARE fetched_value datatype_of_column1;\n\n    -- Open the cursor\n    OPEN cursor_name;\n\n    -- Fetch the first row\n    FETCH FROM cursor_name INTO fetched_value;\n\n    -- Loop through all rows\n    WHILE ... -- condition to continue\n    DO\n        -- Process the data row by row\n        ...\n\n        -- Fetch the next row\n        FETCH FROM cursor_name INTO fetched_value;\n    END WHILE;\n\n    -- Close the cursor\n    CLOSE cursor_name;\nEND;\n"})}),"\n",(0,n.jsx)(r.p,{children:"This is a very general pattern; the specific syntax and features can vary between databases like MySQL, PostgreSQL, Oracle, SQL Server, etc. Some databases may have additional functionality related to cursors, like scrollability (the ability to move the cursor in both directions) and holdability (the cursor stays open after a transaction is committed)."}),"\n",(0,n.jsx)(r.h2,{id:"triggers",children:"Triggers"}),"\n",(0,n.jsxs)(r.p,{children:["Triggers are stored procedures that are automatically executed (fired) in response to specific events on a particular table or view in a database. These events can include ",(0,n.jsx)(r.code,{children:"INSERT"}),", ",(0,n.jsx)(r.code,{children:"UPDATE"}),", or ",(0,n.jsx)(r.code,{children:"DELETE"})," operations. Triggers are useful for enforcing business rules, validating data, and maintaining data integrity."]}),"\n",(0,n.jsx)(r.h3,{id:"creating-a-trigger",children:"Creating a Trigger"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"CREATE TRIGGER trigger_name trigger_time trigger_event\nON table_name FOR EACH ROW\nBEGIN\n    -- Trigger logic here\nEND;\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"CREATE TRIGGER trigger_name BEFORE|AFTER INSERT|UPDATE|DELETE\nON table_name FOR EACH ROW\nBEGIN\n    -- Trigger logic here\nEND;\n"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"trigger_name"}),": The name of the trigger. as a convention, ",(0,n.jsx)(r.code,{children:"tr_moment_event_table"})," is used."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"trigger_time"}),": The time when the trigger should be executed (",(0,n.jsx)(r.code,{children:"BEFORE"})," or ",(0,n.jsx)(r.code,{children:"AFTER"}),")."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"trigger_event"}),": The event that triggers the execution of the trigger (",(0,n.jsx)(r.code,{children:"INSERT"}),", ",(0,n.jsx)(r.code,{children:"UPDATE"}),", or ",(0,n.jsx)(r.code,{children:"DELETE"}),")."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"table_name"}),": The name of the table on which the trigger is defined."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"FOR EACH ROW"}),": Specifies that the trigger should be fired for each row inserted, updated, or deleted."]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"dropping-a-trigger",children:"Dropping a Trigger"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"DROP TRIGGER trigger_name;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"old-and-new-pseudo-rows",children:"OLD and NEW Pseudo-Rows"}),"\n",(0,n.jsxs)(r.p,{children:["Within a trigger, you can access two special pseudo-rows: ",(0,n.jsx)(r.code,{children:"OLD"})," and ",(0,n.jsx)(r.code,{children:"NEW"}),". These pseudo-rows represent the state of the row before and after the triggering event, respectively."]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"OLD"}),": Represents the state of the row before an ",(0,n.jsx)(r.code,{children:"UPDATE"})," or ",(0,n.jsx)(r.code,{children:"DELETE"})," operation."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"NEW"}),": Represents the state of the row after an ",(0,n.jsx)(r.code,{children:"INSERT"})," or ",(0,n.jsx)(r.code,{children:"UPDATE"})," operation."]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"example-in-sql-1",children:"Example in SQL"}),"\n",(0,n.jsx)(r.p,{children:"Here's an example of a trigger that automatically updates a timestamp column when a row is inserted or updated:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"CREATE TRIGGER tr_update_timestamp\nBEFORE INSERT OR UPDATE\nON table_name FOR EACH ROW\nBEGIN\n    SET NEW.updated_at = NOW();\nEND;\n"})})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>o});var n=s(6540);const t={},a=n.createContext(t);function i(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);